graph TD
    A[下载请求触发 (e.g., 用户点击搜索结果)] --> B(Flask 调用 get_dlink 工具);
    B --> C(Flask 发送 HTTP POST /getdlink 到 Java 后端);
    C --> D(Java 后端接收请求);
    D --> E(Java: 使用 Selenium 导航到书籍页面);
    E --> F(Java: 检查登录状态/配额);
    F --> G(Java: 检查本地下载目录是否存在文件);
    G --> H{本地文件找到且匹配?};
    H -- 是 --> I(Java: 返回本地文件 URL);
    H -- 否 --> J(Java: 使用 Selenium 点击下载按钮);
    J --> K(Selenium 触发浏览器下载文件);
    K --> L(Java: 监控下载进度/结果);
    L --> I; %% 下载完成/失败后，确定返回结果
    I --> M(Java: 返回结果/状态给 Flask);
    M --> N(Flask: 接收并处理结果);
    N --> O(Flask: 发送结果到浏览器);
    %% 记录下载历史主要在文件服务流程 (Flow 6.2) 中进行