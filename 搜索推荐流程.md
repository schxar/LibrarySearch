```mermaid
graph TD
    A[用户请求搜索推荐/提交表单] --> B(浏览器发送 HTTP POST 到 Flask 后端);
    B --> C(Flask 后端接收请求);
    C --> D(Flask: 连接 MySQL 数据库);
    D --> E(Flask: 查询 DownloadHistory 表 (使用哈希邮件) 获取历史文件名);
    E --> F(数据库返回用户下载历史);
    F --> G(Flask: 根据历史文件名生成提示);
    G --> H(Flask 发送 HTTP POST 到 豆瓣机器人 API (bot-...) 调用分析);
    H --> I(豆瓣机器人返回原始推荐文本);
    I --> J(Flask: 清理和处理推荐列表);
    J --> K(Flask: 可选保存推荐到 SearchRecommendations DB);
    J --> L(Flask: 格式化并发送推荐到浏览器);
```