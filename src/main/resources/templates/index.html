<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OpenDelta Z Library Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="container mt-5">
    <h1 class="mb-4">OpenDelta Z Library Search</h1>

    <!-- Search Bar -->
    <div class="input-group mb-3">
        <input type="text" id="searchQuery" class="form-control" placeholder="Enter search keyword" aria-label="Search" />
        <button id="searchButton" class="btn btn-primary">Search</button>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="text-center mb-3" style="display: none;">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Results Section -->
    <div id="results">
        <!-- Results will be dynamically loaded here -->
    </div>

    <!-- Search Leaderboard -->
    <h2 class="mt-5">Top Searches</h2>
    <div id="leaderboard" class="mb-4">
        <!-- Leaderboard will be dynamically loaded here -->
    </div>

    <script>
        $(document).ready(function () {
            // Load leaderboard on page load
            loadLeaderboard();

            function loadLeaderboard() {
                $.ajax({
                    url: "/api/top-searches",
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        renderLeaderboard(data);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error("Error loading leaderboard:", textStatus, errorThrown, jqXHR.responseText);
                        $("#leaderboard").html("<div class='alert alert-danger'>Failed to load leaderboard.</div>");
                    },
                });
            }

            function renderLeaderboard(data) {
                let html = "";

                if (data && data.length > 0) {
                    html += "<ul class='list-group'>";
                    data.forEach(function (item, index) {
                        html += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>${index + 1}. ${item.original}</span>
                                <span class="badge bg-primary">${item.weight} searches</span>
                            </li>
                        `;
                    });
                    html += "</ul>";
                } else {
                    html = "<div class='alert alert-warning'>No top searches found.</div>";
                }

                $("#leaderboard").html(html);
            }

            $(document).ready(function () {
                loadLeaderboard();
            });

    </script>
</body>

</html>
