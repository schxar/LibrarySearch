```mermaid
graph TD
    subgraph 本地图书文件管理流程
        direction TD

        subgraph 列出文件
            direction LR
            list_java[用户请求 书籍列表/搜索本地索引] --> http_get_java[浏览器 HTTP GET 到 Java 后端];
            http_get_java --> java_list_req[Java 后端接收];
            java_list_req --> java_scan_meta[Java: 扫描书籍元数据目录];
            java_scan_meta --> java_process_meta[Java: 读取/处理 JSON];
            java_process_meta --> java_render_html[Java: 过滤/渲染 HTML];
            java_render_html --> browser_display_java[Java 发送 HTML];

            list_flask[用户请求 下载文件列表] --> http_get_flask[浏览器 HTTP GET 到 Flask 后端];
            http_get_flask --> flask_list_req[Flask 后端接收];
            flask_list_req --> flask_scan_download[Flask: 扫描下载目录];
            flask_scan_download --> flask_list_files[Flask: 列出文件];
            flask_list_files --> flask_return_list[Flask 返回 JSON/HTML];
            flask_return_list --> browser_display_flask[浏览器显示列表];
        end

        subgraph 提供文件服务
            direction TD
            download_req[用户请求下载特定文件] --> http_get_download[浏览器 HTTP GET /download/<filename>];
            http_get_download --> flask_download_req[Flask 后端接收];
            flask_download_req --> flask_access_file[Flask: 访问本地文件];
            flask_access_file --> flask_record_history[Flask: 记录下载历史到 DB<br/>(哈希邮件/文件名)];
            flask_record_history --> flask_send_file[Flask: 发送文件内容];
            flask_send_file --> browser_download_file[浏览器下载文件];
        end

        subgraph 文件重复删除 (后台)
            direction TD
            dedup_trigger[后台任务触发 (e.g., 定时)] --> scan_dir[系统: 扫描下载目录];
            scan_dir --> find_duplicates[系统: 识别重复项];
            find_duplicates --> delete_duplicates[系统: 删除重复文件];
        end
    end
```