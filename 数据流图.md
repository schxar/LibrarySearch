```mermaid
graph TD
    A[User Interface] --> |User Requests<br>(Web UI, Forms, API Endpoints)| B{Flask Main App<br>(Port 10805)};

    B --> |Forwards API Requests<br>(/api/doubao/*, /api/chat/*)| C{Flask Doubao/Chat Service<br>(Port 10806)};
    B <--> |Download History Query/Result<br>Recommendations, Tickets| G[MySQL Database];
    B --> |Serve Downloaded Files| H[File System];
    B --> |Generate Recommendations| I[Doubao API<br>(Chat, Embeddings, Vision)];

    C --> |Execute Tools<br>(ZLib Search, Get DLink, CSE, etc.)| D[Python Tools Module];
    C <--> |Chat History Persistence<br>Load CSE Config| H[File System];
    C <--> |Chat Completion<br>Tool Calling Response<br>LLM Calls| I[Doubao API<br>(Chat, Embeddings, Vision)];

    D --> |Call /search API (ZLib Search)<br>Call /getdlink API (Get Download Link)| E{Java Backend<br>(Port 8080)};
    D --> |LLM Calls<br>(Embeddings, Evaluation, Bot Calls, VLM)| I[Doubao API<br>(Chat, Embeddings, Vision)];
    D --> |Web Search Query| J[Google CSE API];
    D --> |Initiate Selenium for Page Analysis| K[Selenium WebDriver];

    E --> |Initiate Selenium<br>(ZLib Search Scraping, Get DLink, Download Quota Check,<br>Initiate Download)| K[Selenium WebDriver];
    E --> |Upload Search History| G[MySQL Database];
    E <--> |Local Book Data (JSON)<br>Cache Files, Search History Files (JSON)<br>Serve Local Book Data<br>Check Download Directory| H[File System];

    K --> |Control Browser| L[Browser Instance];
    L <--> |Browse, Scrape Content, Initiate Download| M[Z-Library Website];

    G --> |Query Results (History, Recommendations, Tickets)| B{Flask Main App<br>(Port 10805)};
    H --> |File Data (Downloaded Files)| B{Flask Main App<br>(Port 10805)};
    H --> |File Data (Chat History, CSE Config)| C{Flask Doubao/Chat Service<br>(Port 10806)};
    H --> |File Data (Cache, Search History Files, Local Book Data)| E{Java Backend<br>(Port 8080)};

    E --> |API Responses (Search Results, DLink)| D[Python Tools Module];
    I --> |LLM Responses (Embeddings, Eval, Bot Results, VLM Results)| D[Python Tools Module];
    I --> |Recommendation Results| B{Flask Main App<br>(Port 10805)};
    I --> |Chat/Tool Responses| C{Flask Doubao/Chat Service<br>(Port 10806)};
    J --> |Search Results| D[Python Tools Module];
    M --> |Page Data / Download Trigger| L[Browser Instance];


    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style C fill:#bbf,stroke:#333,stroke-width:2px
    style D fill:#cfc,stroke:#333,stroke-width:2px
    style E fill:#ffc,stroke:#333,stroke-width:2px
    style G fill:#ddf,stroke:#333,stroke-width:2px
    style H fill:#ddd,stroke:#333,stroke-width:2px
    style I fill:#ccf,stroke:#333,stroke-width:2px
    style J fill:#ccf,stroke:#333,stroke-width:2px
    style K fill:#fcf,stroke:#333,stroke-width:2px
    style L fill:#eee,stroke:#333,stroke-width:2px
    style M fill:#eee,stroke:#333,stroke-width:2px
```
